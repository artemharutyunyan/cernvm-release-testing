\section{Debian Based Test Client Setup}
\subsection{Installing the system}
\label{sec:debianinstall}
\flushleft
\begin{enumerate}
\item 	Install the system as you would for any other Linux distribution, except pay attention to the following instructions on
		configuring Debian to use ext4 (if available) instead of ext3 as the performance gains are noticeable.


\item	Now, when prompted by the installer to configure the partitioning layout, if there are other operating systems installed on the 
		system select the ``Guided - use entire disk'' option, and if available select the option ``Use Remaining Free Space''. 
		Otherwise, if there are no other operating system installed on the hard drive select the ``Manual'' option, \emph{beware that 
		doing so will risk erasing everything on the hard drive if you create a new partition table}. Using the manual option, create 
		two primary partitions, with the first taking up the size of the hard drive minus twice the size of the amount of RAM installed, 
		and the second primary partition as a SWAP file using the remaining free space. The following is an example of what the partiton 
		layout would look like for a 40.0 GB hard drive with 2GB of ram.

\lstset{language=bash,caption=Manual Partition Layout Example}
\begin{lstlisting}
#1	PRIMARY	36.0 GB		B f	 EXT4	/
#2	PRIMARY	4.0  GB		  f	 SWAP	SWAP
\end{lstlisting}

\item 	Finally, the last important installation setting, when prompted to choose software to install, select the following
\begin{itemize}
\item 	Graphical desktop environment
\item 	SSH Server
\item	Standard system utilities
\end{itemize}
\end{enumerate}




\subsection{Configuring the system}
\label{sec:debianconfig}
\begin{enumerate}
\item	After the system has booted remove the follow unnecessary startup applications by selecting from the menu  
		\verb|System -> Preferences -> Startup Applications|
\begin{itemize}
\item	bluetooth
\item	evolution alarm
\item	Gnome Login Sound
\item	print queue
\item	screensaver
\item	update notifier
\item	visual assistance/aid
\item	volume control
\item	any others you think are unnecessary based on your own discretion
\end{itemize}

\item Remove the follow unnecessary services by selecting from the menu \verb|System -> Administration -> Services|
\begin{itemize}
\item	alsa utils
\item	bluetooth
\item	CUPS
\item	exim4
\item	any others you think are unnecessary based on your own discretion
\end{itemize}

\item Next enable and configure remote desktop from the menu \verb|System -> Preferences -> Remote Desktop| and ensure
that the following options are configured
\begin{itemize}
\item	Enable the option ``Allow others to view your desktop''
\item	Enable the option ``Allow other users to control your desktop''
\item	Disable the option ``You must confirm access to this machine''
\end{itemize}

\item Next configure the system to login automatically at boot from the menu select \verb|System -> Administration -> Login Screen|
and then set it to login to the user account you created previously (such as cernvm) automatically.

\item Next, remove cd-rom support from sources.list, which is used by Debian for updates \footnote{And is a nuisance for any new user
as it forces you to find the CD and put it in the computer for the update to continue}, execute the following command with root privileges
and comment out any lines that start with ``deb cdrom'' by using a \#

\lstset{language=bash,caption=Removing CD-ROM Requirement for Updates}
\begin{lstlisting}
$ su -c "gedit /etc/apt/sources.list"
\end{lstlisting}

\item	Again, continue to edit /etc/apt/sources.list still with root privileges and ensure that each line ends with ``main 
		contrib non-free'', then save the file and do the following command with root privileges.

\lstset{language=bash,caption=Updating the System}
\begin{lstlisting}
$ su -c "apt-get update"
\end{lstlisting}

\item Next, configure the screen saver from the menu \verb|System -> Preferences -> Screensaver| and ensure that the following options are 
configured
\begin{itemize}
\item	Disable the option ``Lock screen when screensaver active''
\end{itemize}

\item 	The following instructions involve enabling headless support so that you can remote desktop to the machine without having a 
		monitor connected to the computer
\begin{itemize}
\item[a.] Edit the xorg.conf file and put the following in it

\lstset{language=bash,caption=Configuring Xorg for Headless Support}
\begin{lstlisting}
$ su -c "gedit /etc/X11/xorg.conf"

Section "Device"
Identifier "VNC Device"
Driver "vesa"
EndSection

Section "Screen"
Identifier "VNC Screen"
Device "VNC Device"
Monitor "VNC Monitor"
SubSection "Display"
Modes "1280x1024"
EndSubSection
EndSection

Section "Monitor"
Identifier "VNC Monitor"
HorizSync 30-70
VertRefresh 50-75
EndSection
\end{lstlisting}
	
\item[b.] Then edit grub and set the option ``nomodeset'', and proceed to update grub and reboot

\lstset{language=bash,caption=Configuring Grub for Headless Support}
\begin{lstlisting}
$ su -c "gedit /etc/default/grub"

GRUB_CMDLINE_LINUX="nomodeset"

$ su -c "update-grub"
\end{lstlisting}
\end{itemize}

\item	Now, reboot the machine, and ensure that the following work
\begin{itemize}
\item	It automatically boots up into the full desktop environment without having to login
\item	You have access to the machine using SSH and can login on the root account
\item	You have VNC access to the machine and can control the system using VNC	
\end{itemize}

\item	Finally, update the system from the menu \verb|System -> Administration -> Update Manager| and after it has 
		completed the updates reboot the system
\end{enumerate}




\subsection{Installing libvirt and virsh}
\label{sec:debianvirsh}
\begin{enumerate}
\item	The virtualization API libvirt and the command line tool virsh~\cite{libvirt} are the essential components required 
		for setting up a test client and must be installed and properly configured before any testing can begin. Ensure that
		you follow the proceeding directions carefully and validate that virsh is working properly before proceeding to 
		install and configure the various hypervisors.
		
\item	First, begin by reviewing the release news listed on the libvirt website, \url{http://libvirt.org/news.htm} and read 
		through the release notes for the latest version released to make sure that there are no regressions or deprecated 
		support for the platforms you wish to support. If you intend to set up an entire infrastructure and support all of the
		\cernvm virtualization platforms, which would include \emph{Xen, KVM, VirtualBox, and VMware}, then you must download
		a version later than \emph{0.8.7} as there was no support for VMware prior to that release.

\item	Next, download the latest release that is a {\bf tar.gz} file from the libvirt release server, 
		\url{http://libvirt.org/sources/} based on the latest release which does not have any regressions or deprecations for
		the virtualization platforms you wish to support~\footnote{This shouldn't be an issue but just in case there is a 
		newer version in which Xen support is deprecated, then you would need to use the last release which has Xen support}.
		As of this date, the latest release of libvirt is version 0.9.2, this is the release that will be used for the
		following instructions and examples.
		
\item	Next, install the following dependencies which are required to install the libvirt files from the source files
		that were downloaded, \emph{from now on execute all commands as root}.

\lstset{language=bash,caption=Install Dependencies}
\begin{lstlisting}
$ su
$ apt-get install libxen-dev gnutls-dev libnuma-dev \
libdevmapper-dev python-dev libnl-dev
\end{lstlisting}
		
\item	Next extract the files and execute configure with the following options, then finally compile and install libvirt.

\lstset{language=bash,caption=Compile and Install libvirt}
\begin{lstlisting}
# Extract and execute configure
$ tar -xvvzf libvirt-*.tar.gz
$ cd libvirt-*/
$ ./configure --disable-silent-rules --disable-shared --enable-static \
--enable-dependency-tracking --with-xen --with-xen-inotify --with-qemu \
--with-vmware --with-libssh2 --with-vbox --with-test --with-remote \
--with-libvirtd --with-numactl --with-network --with-storage-dir

# Compile and install libvirt
$ make 
$ make install
\end{lstlisting}

\item 	Finally, start the service libvirtd, and ensure that virsh installed correctly and is running by 
		connecting to the test hypervisor and ensuring that the test virtual machine, named ``test'' is running.

\lstset{language=bash,caption=Verify virsh was Installed Properly}
\begin{lstlisting}
# Change to root account, enter password if prompted
$ su

# Verify virsh is working, test should be running
$ virsh -c test:///default list --all
\end{lstlisting}
\end{enumerate}




\subsection{Installing and configuring KVM}
\label{sec:debiankvm}
\begin{enumerate}
\item	The first step is to install the KVM hypervisor, start by installing KVM and the other additional packages such
		as virt-manager, which is a graphical management tool and virt-install, which is a command line interface (CLI)
		virtual machine creation/installation/configuration tool using the following commands with root privileges. If
		you receive a message that a package is already installed then simply continue.

\lstset{language=bash,caption=Installing KVM and Other Related Programs}
\begin{lstlisting}
$  su -c "apt-get install qemu-kvm virt-manager"
\end{lstlisting}

\item	Next, verify that KVM has been installed properly and that virsh can connect to the KVM hypervisor using the
		following commands, if you are able to connect to the virsh console without any errors then virsh is able
		to connect to the KVM hypervisor.

\lstset{language=bash,caption=Verify that virsh can Access KVM}
\begin{lstlisting}
$ su
$ virsh -c qemu:///session
\end{lstlisting}

\item 	Finally, to ensure that KVM is properly configured and installed, follow this guide provided on the CernVM website
		\url{http://cernvm.cern.ch/portal/kvm} {\bf except, do not create a kvm definition file as the xml template file
		is provided by the test suite scripts} and verify that you are able to connect to the libvirtd kvm system session.
		
\lstset{language=bash,caption=Verify that KVM is Properly Configured}
\begin{lstlisting}
$ su
$ virsh -c qemu:///system 
\end{lstlisting}
\end{enumerate}




\subsection{Installing and configuring VirtualBox}
\label{sec:debianvbox}
\begin{enumerate}
\item	First, begin by downloading and installing a version of VirtualBox supported by libvirt from the VirtualBox download 
		page, it is best to download the latest version within the series \emph{that has been available for at least a month 
		prior to the release of the version of libvirt installed}. VirtualBox can be downloaded from the following location,  
		\url{http://www.virtualbox.org/wiki/Downloads} ensure that you select the appropriate Debian based distribution, 
		version and architecture for your system. The following instructions for this section of the guide uses VirtualBox 
		4.0.10 for Debian Squeeze, AMD64.
		 	
\item	Next, after downloading the latest version of VirtualBox for your distribution install VirtualBox as the root
		account using the following command.
\begin{lstlisting}
# Enter the root password when prompted
$ su
$ dpkg -i VirtualBox-*.deb
\end{lstlisting}	

\item	Next, in order to use VirtualBox and have full access to the drivers needed for USB support, ensure that the root
		account belongs to the group ``vboxusers''. Begin by navigating to \verb|System -> Users and Groups| and then from
		the ``User Manager'' window click the ``Groups'' tab, under the column ``Group Name'' for the group ``vboxusers'' 
		ensure that root is one of the group members. If the root account is not a group member of ``vboxusers'' highlight
		the ``vboxusers'' entry and click the ``Properties'' button, then enable the root account from the list of users
		and click ``OK'' to apply the changes.
		
\item	Due to an issue with VirtualBox\footnote{The issues is that VirtualBox looks for virtual machine configuration files (*.vbox)
		in the ``VirtualBox VMs'' folder of the user that launched VirtualBox. The issue is worsened by the fact that there can
		only be one ``VirtualBox VMs'' folder which causes conflicts with multiple users.}, in order for it to work with virsh 
		the virtual machine(s) must be created and configured as the root account, otherwise when you try to connect or start a 
		VirtualBox virtual machine with virsh you will get an ``unknown error'', which is obviously very vague and difficult to 
		resolve. {\bf Therefore ALWAYS start VirtualBox as the root account using the following procedure}.

\lstset{language=bash,caption=Always Start VirtualBox as Root}
\begin{lstlisting}
# Switch to the root account, enter root password
$ su

# Start VirtualBox as root
$ virtualbox
\end{lstlisting}

\item	Finally, verify that VirtualBox has been installed properly and that virsh can connect to the VirtualBox hypervisor, 
		verify that the VirtualBox module, \emph{vboxdrv} has been loaded and that you are able to connect to the virsh console 
		without any errors.

\lstset{language=bash,caption=Verify that virsh can Access VirtualBox}
\begin{lstlisting}
$ su

# Verify that the vboxdrv module is loaded
$ lsmod | grep -i vboxdrv

# Verify that virsh can connect to virtualbox
$ virsh -c vbox:///session
\end{lstlisting}
\end{enumerate}




\subsection{Installing and configuring VMware}
\label{sec:debianvmware}
\begin{enumerate}
\item	First, begin by downloading and installing the latest version of VMware Workstation or Player  from the VMware product 
		page, \url{http://www.vmware.com/products/}, VMware Workstation requires a license, so you will have to purchase it
		in order to continue.
		
\item	Next, to verify that VMware Workstation has been installed properly, verify that the following VMware kernel modules 
		are loaded, currently virsh has support to connect to the VMware hypervisor, but there are some minor issues such as
		a lack of support for VMware network configurations, currently only ``bridged'' mode is supported.
		
\begin{itemize}
\item        vmnet
\item        vmblock
\item        vmci
\item        vmmon

\end{itemize}

\lstset{language=bash,caption=Verify VMware Kernel Extensions Loaded}
\begin{lstlisting}
# Verify that the kernel extentsions are loaded
$ lsmod | grep -i vm
\end{lstlisting}

.\item      Finally, verify that VMware has been configured properly and that virsh supports the current version of VMware 
                installed by connecting to the virsh console for the VMware hypervisor.

\lstset{language=bash,caption=Verify VMware Works with Virsh}
\begin{lstlisting}
# Verify that virsh can connect to vmware
$ virsh --connect vmwarews:///session
\end{lstlisting}

\item	If everything so far has worked, then libvirt, virsh, and the hypervisors have been installed and configured properly,
		if you have any outstanding issues solve them before proceeding further, or go to the section ``Server Platform 		
		Setup''~\ref{sec:serversetup} as the \tapper~server does not require libvirt, virsh, or hypervisor configuration.
		
\end{enumerate}




%\newpage
%\subsection{Setting up the Tapper Test Suite}
%\label{sec:debiantestsuite}
%\begin{enumerate}
%\item 	{\bf Before proceeding any further ensure that you have all other test clients set up this far, and then proceed
%		to follow the instructions for setting up and configuring the \tapper~server in the section ``Server Platform Setup''}		
%		~\ref{sec:serversetup}.
%\end{enumerate}